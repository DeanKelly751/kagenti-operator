# Complete example: AgentCard with SPIRE x5c signature verification + identity binding
#
# Prerequisites:
#   - SPIRE deployed with ClusterSPIFFEID configured for the workload
#   - Operator started with --require-a2a-signature=true --spire-trust-domain=<domain>
#   - Trust bundle ConfigMap available (--spire-trust-bundle-configmap, --spire-trust-bundle-configmap-namespace)
#
# The operator verifies the JWS signature on the agent card using the x5c
# certificate chain, then validates that the leaf certificate's SPIFFE ID
# belongs to the configured trust domain.
apiVersion: agent.kagenti.dev/v1alpha1
kind: AgentCard
metadata:
  name: weather-agent-card
  namespace: agents
spec:
  syncPeriod: "30s"
  targetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: weather-agent
  identityBinding:
    # Optional: override the operator-level --spire-trust-domain for this card.
    # If omitted, the operator flag value is used.
    # trustDomain: "cluster.local"

    # Strict mode: binding failures trigger network isolation via NetworkPolicy
    # (requires --enforce-network-policies=true).
    # When false (default), failures are recorded in status only (audit mode).
    strict: true
