apiVersion: apps/v1
kind: Deployment
metadata:
  name: echo-agent
  namespace: agents
  labels:
    kagenti.io/type: agent
    protocol.kagenti.io/a2a: ""
    app.kubernetes.io/name: echo-agent
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: echo-agent
      kagenti.io/type: agent
  template:
    metadata:
      labels:
        app.kubernetes.io/name: echo-agent
        kagenti.io/type: agent
        protocol.kagenti.io/a2a: ""
    spec:
      containers:
        - name: echo
          image: docker.io/python:3.11-slim
          command:
            - python3
            - -c
            - |
              import http.server, json
              class H(http.server.BaseHTTPRequestHandler):
                  def do_GET(self):
                      if self.path == '/.well-known/agent.json':
                          card = {'name': 'Echo Agent', 'version': '1.0.0',
                                  'url': 'http://echo-agent.agents.svc:8001'}
                          self.send_response(200)
                          self.send_header('Content-Type', 'application/json')
                          self.end_headers()
                          self.wfile.write(json.dumps(card).encode())
                      else:
                          self.send_response(404)
                          self.end_headers()
                  def log_message(self, *a): pass
              http.server.HTTPServer(('', 8001), H).serve_forever()
          ports:
            - containerPort: 8001
---
apiVersion: v1
kind: Service
metadata:
  name: echo-agent
  namespace: agents
spec:
  selector:
    app.kubernetes.io/name: echo-agent
  ports:
    - port: 8001
      targetPort: 8001
